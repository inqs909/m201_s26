{
  "hash": "b804ff17fe37dafc56c6fd7428823658",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Statistical Inference\"\nsubtitle: \"Group Model Inference\"\ndescription: |\n  Testing the difference in groups.\n\nformat:\n  revealjs:\n    width: 1200\n    scrollable: true\n    sc-sb-title: true\n    footer: m201.inqs.info/lectures/11\n    theme: [default, styles.scss]\n    navigation-mode: vertical\n    controls-layout: edges\n    controls-tutorial: true\n    slide-number: true\n    pointer:\n      pointerSize: 32\n    incremental: false \n    chalkboard:\n      theme: whiteboard\n      chalk-width: 4\nknitr:\n  opts_chunk: \n    echo: true\n    eval: true\n    message: false\n    code-fold: true\n    warnings: false\n    comment: \"#>\" \n    \nrevealjs-plugins:\n  - pointer\n  - verticator\n  \nfilters: \n  - reveal-header\n  - code-fullscreen\n  - reveal-auto-agenda\n\neditor: source\n---\n\n\n\n# Motivating Example\n\n## Species and Body Mass\n\n:::: {.columns}\n::: {.column width=\"40%\"}\n\n- Is there a difference in body mass between the penguins species?\n- Is the difference due to a natural phenomenon or randomness?\n:::\n::: {.column width=\"60%\"}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\npenguins |> ggplot(aes(x=species, y = body_mass)) +\n  geom_jitter() + \n  geom_boxplot() + \n  labs(x = \"Species\", y = \"Body Mass\")\n```\n\n::: {.cell-output-display}\n![](11_files/figure-revealjs/unnamed-chunk-2-1.png){fig-align='center' fig-alt='A box plot and jitter plot being displayed for body mass by penguin species.' width=960}\n:::\n:::\n\n\n:::\n::::\n\n\n\n## Chest Pain and Heart Disease\n\n:::: {.columns}\n::: {.column width=\"40%\"}\n\n- Is there a difference in proportions between the different chest pains?\n\n- Is the difference due to a natural phenomenon or randomness?\n:::\n::: {.column width=\"60%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nheart_disease |> ggplot(aes(x=cp, fill = disease)) +\n  geom_bar(position = \"fill\") +\n  labs(x = \"Chest Pain\") + \n  theme(axis.text.x = element_text(size = 14)) \n```\n\n::: {.cell-output-display}\n![](11_files/figure-revealjs/unnamed-chunk-3-1.png){fig-alt='A stacked bar plot showing chest pain and count by having heart disease or not.' width=960}\n:::\n:::\n\n\n:::\n::::\n\n# Model Inference\n\n## Model Inference\n\n**Model Inference** is the act of conducting a hypothesis test on the entire model (line). We do this to determine if the fully explained model is **significantly** different from the smaller models or average.\n\n::: fragment\nModel inference determines if more variation is explained by including more predictors.\n:::\n\n## Model inference\n\n- We will conduct model inference to determine if different models are better at explaining variation. Both Linear and Logistic Regression have techniques to test different models. \n\n- For Linear Regression, we determine the significance of the variation explained using an Analysis of Variance (ANOVA) table and F test.\n\n- For Logistic Regression, we determine the significance of the variation explained using a Likelihood Ratio test.\n\n- Conducting Model Inference first ensures that the **Family-wise Error Rate** is controlled.\n\n## Full and Reduced Model\n\n::: {.columns}\n::: {.column}\n\n#### Full Model\n\n$$\nY =  \\beta_0 + \\beta_1 X_1 + \\cdots + \\beta_p X_p\n$$\n\n:::\n::: {.column}\n\n#### Reduced Model\n\n$$\nY =  \\beta_0 + \\beta_1 X_1\n$$\n\n:::\n:::\n\n## Null and Alt Hypothesis\n\n$H_0$: The fully-parameterized model does not explain more variation than the reduced model.\n\n$H_a$: The fully-parameterized model does explain more variation than the reduced model.\n\n\n## Group Model Inference\n\n- **Group Model Inference** tests whether a **categorical** variable significantly reduces the variation of the outcome of interest.\n\n- This tells us if the group means are different from each other.\n\n## Group Full and Reduced Model\n\n::: {.columns}\n::: {.column}\n\n#### Full Model\n\n$$\nY =  \\beta_0 + \\beta_1 C_1 + \\cdots + \\beta_p C_p\n$$\n\n:::\n::: {.column}\n\n#### Reduced Model\n\n$$\nY =  \\bar Y\n$$\n\n:::\n:::\n\n## Group Null and Alt Hypothesis\n\n$H_0$: The different categories do not have significantly different means/proportions from each other.\n\n$H_a$: At least two categories have significantly different means/proportions from each other. \n\n\n# Family-wise Error Rate\n\n## Motivation\n\n* In multiple hypothesis testing, we test several hypotheses simultaneously.\n* The probability of making **at least one Type I error** increases with the number of tests.\n* Hence, we need **error control** methods.\n\n\n## Type I Error and Its Rate\n\n**Type I Error (False Positive):** Rejecting a null hypothesis ($H_0$), when it is true.\n\n**Type I Error Rate ($\\alpha$):**\nThe probability of making a Type I error in a single hypothesis test.\n\n$$\n\\alpha = P(\\text{Reject } H_0 \\mid H_0 \\text{ is true})\n$$\n\nTypically, $\\alpha = 0.05$, meaning a 5% chance of incorrectly rejecting a true null hypothesis.\n\n\n## Definition of FWER\n\n**Family-Wise Error Rate (FWER):**\nThe probability of making **one or more Type I errors** among all hypotheses tested.\n\n$$\n\\text{FWER} = P(\\text{At least one false rejection}) = P(V \\ge 1)\n$$\n\nwhere:\n\n* $V$ = number of false positives (incorrect rejections)\n\n## Why Control FWER?\n\n* Maintains overall confidence in conclusions.\n* Avoids claiming false discoveries when many tests are run.\n* Trade-off: Strong control of FWER reduces **power** (increases Type II error).\n\n\n## Methods to Control FWER\n\n1. Bonferroni Correction\n\n2. Holm-Bonferroni Procedure (Step-down)\n\n3. Tukeyâ€™s Honest Significant Difference (HSD)\n\n\n\n# Linear Model Inference\n\n## Linear Model Inference\n\nGiven 2 models:\n\n$$\n\\hat Y = \\hat\\beta_0 + \\hat\\beta_1 X_1 + \\hat\\beta_2 X_2 + \\cdots + \\hat\\beta_p X_p\n$$\n\nor\n\n$$\n\\hat Y = \\bar y\n$$\n\n::: fragment\nIs the model with predictors do a better job than using the average?\n:::\n\n## Linear Models: Difference Groups\n\nGiven a categorical variable with 4 categories, which model is better:\n\n$$\n\\hat Y = \\hat\\beta_0 + \\hat\\beta_1 C_1 + \\hat\\beta_2 C_2 + \\hat\\beta_3 C_3  \n$$\n\nor\n\n$$\n\\hat Y = \\bar y\n$$\n\n\n::: fragment\nAre the 2 models different from each other?\n:::\n\n\n## ANOVA Table\n\n| Source | DF        | SS            | MS                    | F                        |\n|---------------|---------------|---------------|---------------|---------------|\n| Model  | $DFR=k-1$ | $SSR$         | $MSR=\\frac{SSM}{DFR}$ | $\\hat F=\\frac{MSR}{MSE}$ |\n| Error  | $DFE=n-k$ | $SSE$         | $MSE=\\frac{SSE}{DFE}$ |                          |\n| Total  | $TDF=n-1$ | $TSS=SSR+SSE$ |                       |                          |\n\n$$\n\\hat F \\sim F(DFR, DFE)\n$$\n\n## Conducting an ANOVA in R\n\n```r\nxlm <- lm(Y ~ X, data = DATA)\nanova(xlm)\n```\n\n- `Y`: Outcome variable in DATA\n- `X`: Categorical variable in DATA\n- `DATA`: Name of the data (frame) set\n\n## Species and Body Mass\n\n:::: {.columns}\n::: {.column width=\"40%\"}\n\n- Is there a difference in body mass between the penguins species?\n- Is the difference due to a natural phenomenon or randomness?\n:::\n::: {.column width=\"60%\"}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\npenguins |> ggplot(aes(x=species, y = body_mass)) +\n  geom_jitter() + \n  geom_boxplot() + \n  labs(x = \"Species\", y = \"Body Mass\")\n```\n\n::: {.cell-output-display}\n![](11_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' fig-alt='A box plot and jitter plot being displayed for body mass by penguin species.' width=960}\n:::\n:::\n\n\n:::\n::::\n\n\n## Example: Hypothesis\n\n- $H_0$: The mean body mass are the same between the 3 penguin species.\n\n- $H_1$: At least one species pairing have different mean body mass.\n\n## Example: ANOVA\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nxlm <- lm(body_mass ~ species, data = penguins)\nanova(xlm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Analysis of Variance Table\n#> \n#> Response: body_mass\n#>            Df    Sum Sq  Mean Sq F value    Pr(>F)    \n#> species     2 145190219 72595110  341.89 < 2.2e-16 ***\n#> Residuals 330  70069447   212332                      \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n# Logistic Model Inference\n\n## Logistic Model Inference\n\nGiven 2 models:\n\n$$\ng(\\hat Y) = \\hat\\beta_0 + \\hat\\beta_1 X_1 + \\hat\\beta_2 X_2 + \\cdots + \\hat\\beta_p X_p\n$$\n\nor\n\n$$\ng(\\hat Y) = \\bar y\n$$\n\n::: fragment\nIs the model with predictors do a better job than using the average?\n:::\n\n## Logistic Model Inference\n\nGiven a categorical variable with 4 categories, which model is better:\n\n$$\ng(\\hat Y) = \\hat\\beta_0 + \\hat\\beta_1 C_1 + \\hat\\beta_2 C_2 + \\hat\\beta_3 C_3  \n$$\n\nor\n\n$$\ng(\\hat Y) = \\bar y\n$$\n\n::: fragment\nAre the 2 models different from each other?\n:::\n\n## Likelihood Ratio Test (Logistic)\n\nThe Likelihood Ratio Test is a test to determine whether the likelihood of observing the outcome is significantly bigger in a larger, more complicated model, than a simpler model. \n\n\nIt conducts a hypothesis tests to see if models are significantly different from each other.\n\n\n## Conducting an LRT in R\n\n```r\nxlm <- glm(Y ~ X, data = DATA, family = binomial)\nanova(xlm)\n```\n\n- `Y`: Outcome variable in DATA\n- `X`: Categorical variable in DATA\n- `DATA`: Name of the data (frame) set\n\n## Chest Pain and Heart Disease\n\n:::: {.columns}\n::: {.column width=\"40%\"}\n\n- Is there a difference in proportions between the different chest pains?\n\n- Is the difference due to a natural phenomenon or randomness?\n:::\n::: {.column width=\"60%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nheart_disease |> ggplot(aes(x=cp, fill = disease)) +\n  geom_bar(position = \"fill\") +\n  labs(x = \"Chest Pain\") + \n  theme(axis.text.x = element_text(size = 14)) \n```\n\n::: {.cell-output-display}\n![](11_files/figure-revealjs/unnamed-chunk-6-1.png){fig-alt='A stacked bar plot showing chest pain and count by having heart disease or not.' width=960}\n:::\n:::\n\n\n:::\n::::\n\n\n## Example: Hypothesis\n\n- $H_0$: The proportion of having heart disease are the same between the 4 chest pain types.\n\n- $H_1$: At least one chest pain pairing have different proportions of having heart disease.\n\n## Example: LRT\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nxglm <- glm(disease ~ cp, data = heart_disease,\n            family = binomial)\nanova(xglm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> Analysis of Deviance Table\n#> \n#> Model: binomial, link: logit\n#> \n#> Response: disease\n#> \n#> Terms added sequentially (first to last)\n#> \n#> \n#>      Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    \n#> NULL                   296     409.95              \n#> cp    3   81.195       293     328.75 < 2.2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n# Post-Hoc Analysis\n\n## Post-Hoc Analysis\n\n- If we found to reject the null hypothesis from our model inference, we conduct a **post-hoc** analysis to determine which groups are significantly different from each other.\n\n- We will conduct multiple comparisons test, while maintaining the family-wise error rate, to determine which groups are different from each other.\n\n\n## Group Proportions Or Means\n\nWe will use the `emmeans` function from the `emmeans` R package to obtain the group proportions or means.\n\n\n## Group Means\n\n```r\nm <- lm(Y ~ X, data = DATA)\nemmeans(m, ~X)\n```\n\n- `Y`: Outcome variable in DATA\n- `X`: Categorical variable in DATA\n- `DATA`: Name of the data (frame) set\n\n## Group Proportions\n\n```r\nm <- glm(Y ~ X, data = DATA, family = binomial)\nemmeans(m, ~X, type = \"response\")\n```\n\n- `Y`: Outcome variable in DATA\n- `X`: Categorical variable in DATA\n- `DATA`: Name of the data (frame) set\n\n## Body Mass by Species\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nm1 <- lm(body_mass ~ species, data = penguins)\nemmeans(m1, ~species)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  species   emmean   SE  df lower.CL upper.CL\n#>  Adelie      3706 38.1 330     3631     3781\n#>  Chinstrap   3733 55.9 330     3623     3843\n#>  Gentoo      5092 42.2 330     5009     5176\n#> \n#> Confidence level used: 0.95\n```\n\n\n:::\n:::\n\n\n## Heart Disease by Chest Pain\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nm2 <- glm(disease ~ cp, data = heart_disease, family = binomial)\nemmeans(m2, ~ cp, type = \"response\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  cp                prob     SE  df asymp.LCL asymp.UCL\n#>  Asymptomatic     0.725 0.0375 Inf    0.6463     0.792\n#>  Atypical Angina  0.184 0.0553 Inf    0.0984     0.317\n#>  Non-anginal Pain 0.217 0.0452 Inf    0.1411     0.318\n#>  Typical Angina   0.304 0.0959 Inf    0.1525     0.515\n#> \n#> Confidence level used: 0.95 \n#> Intervals are back-transformed from the logit scale\n```\n\n\n:::\n:::\n\n\n## Multiple Comparisons Test\n\n- A multi-comparison test can be achieved by using the `pairs` function from the output of the `emmeans` function.\n\n- This function will automatically adjust the p-values using Tukey's method to fix the family-wise error rate.\n\n## Multi-Comparison Test: Means\n\n```r\nm <- lm(Y ~ X, data = DATA)\ne <- emmeans(m, ~X)\npairs(e)\n```\n\n- `Y`: Outcome variable in DATA\n- `X`: Categorical variable in DATA\n- `DATA`: Name of the data (frame) set\n\n## Multi-Comparison Test: Proportions\n\n```r\nm <- glm(Y ~ X, data = DATA, family = binomial)\ne <- emmeans(m, ~X, type = \"response\")\npairs(e)\n```\n\n- `Y`: Outcome variable in DATA\n- `X`: Categorical variable in DATA\n- `DATA`: Name of the data (frame) set\n\n## Body Mass by Species\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nm1 <- lm(body_mass ~ species, data = penguins)\ne1 <- emmeans(m1, ~species)\npairs(e1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  contrast           estimate   SE  df t.ratio p.value\n#>  Adelie - Chinstrap    -26.9 67.7 330  -0.398  0.9164\n#>  Adelie - Gentoo     -1386.3 56.9 330 -24.359 <0.0001\n#>  Chinstrap - Gentoo  -1359.3 70.0 330 -19.406 <0.0001\n#> \n#> P value adjustment: tukey method for comparing a family of 3 estimates\n```\n\n\n:::\n:::\n\n\n## Heart Disease by Chest Pain\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nm2 <- glm(disease ~ cp, data = heart_disease, family = binomial)\ne2 <- emmeans(m2, ~ cp, type = \"response\")\npairs(e2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#>  contrast                             odds.ratio    SE  df null z.ratio p.value\n#>  Asymptomatic / Atypical Angina           11.738 4.860 Inf    1   5.948 <0.0001\n#>  Asymptomatic / (Non-anginal Pain)         9.537 3.110 Inf    1   6.917 <0.0001\n#>  Asymptomatic / Typical Angina             6.037 2.960 Inf    1   3.664  0.0014\n#>  Atypical Angina / (Non-anginal Pain)      0.812 0.370 Inf    1  -0.456  0.9684\n#>  Atypical Angina / Typical Angina          0.514 0.301 Inf    1  -1.138  0.6660\n#>  (Non-anginal Pain) / Typical Angina       0.633 0.333 Inf    1  -0.870  0.8204\n#> \n#> P value adjustment: tukey method for comparing a family of 4 estimates \n#> Tests are performed on the log odds ratio scale\n```\n\n\n:::\n:::\n",
    "supporting": [
      "11_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}