---
title: "Statistical Inference"
subtitle: "Model Inference"
description: |
  Finish the discussion on model inference.
format:
  revealjs:
    width: 1200
    scrollable: true
    theme: [default, styles.scss]
    navigation-mode: vertical
    controls-layout: bottom-right
    controls-tutorial: true
    incremental: false 
    chalkboard:
      src: notes/chalkboard_1a.json
      storage: chalkboard_pres
      theme: whiteboard
      chalk-width: 4
knitr:
  opts_chunk: 
    echo: true
    eval: true
    message: false
    code-fold: true
    warnings: false
    comment: "#>" 
    
revealjs-plugins:
  - pointer
  - verticator
  
filters: 
  - reveal-header
  - code-fullscreen
  - reveal-auto-agenda
editor: source
---

```{r}
#| include: false
library(tidyverse)
library(csucistats)
library(survival)
library(patchwork)
theme_set(theme_bw() + 
            theme(
              axis.text.x = element_text(size = 24),
              axis.title = element_text(size = 30),
              plot.title = element_text(size = 48),
              strip.text = element_text(size = 20),
              legend.title = element_blank(),
              legend.text = element_text(size = 24)))

bladder1$death <- ifelse(bladder1$status %in% c(0, 1), 0, 1)
bladder1$death2 <- ifelse(bladder1$death == 0, "Alive", "Dead")

```




# Model Conditions

## Model Conditions

When we are conducting inference with regression models, we will have to check the following conditions:

-   Linearity
-   Independence
-   Probability Assumption
-   Equal Variances
-   Multicollinearity (for Multi-Regression)

## Linearity

There must be a linear relationship between both the outcome variable (y) and a set of predictors ($x_1$, $x_2$, ...).

## Independence

The data points must not influence each other.

## Probability Assumption

The model errors (also known as residuals) must follow a specified distribution.

## Equal Variances

The variability of the data points must be the same for all predictor values.

## Residuals

Residuals are the errors between the observed value and the estimated model. Common residuals include

-   Raw Residual

-   Standardized Residuals

-   Jackknife (studentized) Residuals

-   Deviance Residuals

-   Quantized Residuals



## Influential Measurements

Influential measures are statistics that determine how much a data point affects the model. Common influential measures are

-   Leverages

-   Cook's Distance

## Raw Residuals

$$
\hat r_i = y_i - \hat y_i
$$

## Residual Analysis

A residual analysis is used to test the assumptions of linear regression.

## QQ Plot

A qq (quantile-quantile) plot will plot the estimated quantiles of the residuals against the theoretical quantiles from a normal distribution function. If the points from the qq-plot lie on the $y=x$ line, it is said that the residuals follow a normal distribution.

## Residual vs Fitted Plot

This plot allows you to assess the linearity, constant variance, and identify potential outliers. Create a scatter plot between the fitted values (x-axis) and the raw/standardized residuals (y-axis).

## Variance Inflation Factor

The variance inflation factor is a measurement on how much variables are collinear with each other. A value greater than 10 is a cause for concern and action should be taken.

## Residual Analysis in R

Use the `resid_df` function to obtain the residuals of a model.

```{r}
#| code-fold: show
#| eval: false

rdf <- resid_df(OBJECT)

```

## Residual vs Fitted Plot

```{r}
#| code-fold: show
#| eval: false


ggplot(RDF, aes(fitted, resid)) +
  geom_point() +
  geom_hline(yintercept = 0, col = "red")

```

## QQ Plot

```{r}
#| code-fold: show
#| eval: false

ggplot(RDF, aes(sample = resid)) + 
  stat_qq() +
  stat_qq_line() 

```


## Example

```{r}
#| code-fold: true
#| eval: false

xlm <- lm(body_mass_g ~   island + species + flipper_length_mm,
          penguins)
dfxlm <- resid_df(xlm)

ggplot(dfxlm, aes(fitted, resid)) +
  geom_point() +
  geom_hline(yintercept = 0, col = "red")

ggplot(dfxlm, aes(sample = resid)) + 
  stat_qq() +
  stat_qq_line() 


```

